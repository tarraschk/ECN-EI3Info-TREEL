//---------------------------------------------------------------------------*

#ifndef SEMAPHORE_DEFINED
#define SEMAPHORE_DEFINED

//---------------------------------------------------------------------------*

#include "task-list.h"

//---------------------------------------------------------------------------*
//   Force C linking for C++ compilation                                     *
//---------------------------------------------------------------------------*

#ifdef __cplusplus
  extern "C" {
#endif

//---------------------------------------------------------------------------*
//                                                                           *
//   S E M A P H O R E                                                       *
//                                                                           *
//---------------------------------------------------------------------------*

typedef struct  {
  task_list mWaitingTaskList ;
  uint32 mValue ;
} semaphore ;

//---------------------------------------------------------------------------*
//                                                                           *
//   I N I T    S E M A P H O R E                                            *
//                                                                           *
//---------------------------------------------------------------------------*

void init_semaphore (semaphore * inSemaphore,
                     const uint32 inInitialValue) ;

//---------------------------------------------------------------------------*
//                                                                           *
//   V    O P E R A T I O N                                                  *
//                                                                           *
//---------------------------------------------------------------------------*

void usr_V (semaphore * inSemaphore) ;

void swi_V (semaphore * inSemaphore) ;

//---------------------------------------------------------------------------*
//                                                                           *
//   P    O P E R A T I O N                                                  *
//                                                                           *
//---------------------------------------------------------------------------*

void usr_P (semaphore * inSemaphore) ;

void swi_P (semaphore * inSemaphore) ;

//---------------------------------------------------------------------------*
//                                                                           *
//   P    U N T I L    O P E R A T I O N                                     *
//                                                                           *
//---------------------------------------------------------------------------*

bool usr_P_until (semaphore * inSemaphore,
                  const uint32 inDeadline) ;

bool swi_P_until (semaphore * inSemaphore,
                  const uint32 inDeadline) ;

//---------------------------------------------------------------------------*
//   End of force C linking for C++ compilation                              *
//---------------------------------------------------------------------------*

#ifdef __cplusplus
  }
#endif

//---------------------------------------------------------------------------*

#endif

