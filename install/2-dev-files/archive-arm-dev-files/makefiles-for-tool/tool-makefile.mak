#----------------------------------------------------------------------*
#                                                                      *
# GENERIC MAKEFILE FOR BUILDING TOOLS                                  *
#                                                                      *
#----------------------------------------------------------------------*

#----------------------------------------------------------------------*
#                                                                      *
# GETTING HOST IDENTIFICATION                                          *
#                                                                      *
#----------------------------------------------------------------------*

PLATFORM := $(shell uname -s)

#----------------------------------------------------------------------*

include $(DEV_DIR)/makefiles-for-tool/tool-makefile-$(PLATFORM).mak

#----------------------------------------------------------------------*
#                                                                      *
# DEFINE LIBRARY LIST                                                  *
#                                                                      *
#----------------------------------------------------------------------*

LIBRARY_OPTION += $(patsubst %, -l%, $(ALL_LIBRARIES))

#----------------------------------------------------------------------*
#                                                                      *
# DEFINE GCC OPTIONS                                                   *
#                                                                      *
#----------------------------------------------------------------------*

OPTIONS_GCC += -O1 -Wall -Werror -fomit-frame-pointer

#----------------------------------------------------------------------*
#                                                                      *
# DEFINE BUILD_DIR VARIABLE                                            *
#                                                                      *
#----------------------------------------------------------------------*

BUILD_DIR := builds

#----------------------------------------------------------------------*

FICHIERS_OBJETS := $(patsubst %, $(BUILD_DIR)/%.o, $(ALL_SOURCES))

#----------------------------------------------------------------------*

$(BUILD_DIR):
	mkdir -p $(BUILD_DIR)

#----------------------------------------------------------------------*
#                                                                      *
# LINKER INFERENCE RULE                                                *
#                                                                      *
#----------------------------------------------------------------------*

$(EXECUTABLE):$(FICHIERS_OBJETS)
	$(LINKER) $(FICHIERS_OBJETS) -o $@ $(LIBRARY_OPTION)
	$(STRIP) $@

#----------------------------------------------------------------------*
#                                                                      *
# INSTALL PATH CREATION INFERENCE RULE                                 *
#                                                                      *
#----------------------------------------------------------------------*

$(INSTALL_PATH):
	sudo mkdir -p $(INSTALL_PATH)

#----------------------------------------------------------------------*
#                                                                      *
# 'ALL' GOAL                                                           *
#                                                                      *
#----------------------------------------------------------------------*

all:$(BUILD_DIR) $(EXECUTABLE)

#----------------------------------------------------------------------*
#                                                                      *
# 'INSTALL' GOAL                                                       *
#                                                                      *
#----------------------------------------------------------------------*

install:all $(INSTALL_PATH)
	sudo cp $(EXECUTABLE) $(INSTALL_PATH)

#----------------------------------------------------------------------*
#                                                                      *
# 'CLEAN' GOAL                                                         *
#                                                                      *
#----------------------------------------------------------------------*

clean:
	rm -fr $(BUILD_DIR)
	rm -f $(EXECUTABLE)

#---------------------------------------------------------------*
#                                                               *
#         Compiler invocation inference rules                   *
#                                                               *
#---------------------------------------------------------------*

OPTIONS_GCC += $(GCC_USER_OPTIONS)
OPTIONS_GCC += $(patsubst %, -I %, $(SOURCE_DIRECTORIES))

TEMP_SOURCE_DIRS := $(SOURCE_DIRECTORIES)
include $(DEV_DIR)/makefiles-for-tool/tool-compiler-call.mak

#----------------------------------------------------------------------*
#                                                                      *
# WEAK INCLUDE OF DEPENDENCE RULES                                     *
#                                                                      *
#----------------------------------------------------------------------*

-include $(BUILD_DIR)/*.dep

#-----------------------------------------------------------------*
